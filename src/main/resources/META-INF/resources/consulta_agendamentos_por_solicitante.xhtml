<ui:composition
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:h="http://xmlns.jcp.org/jsf/html"
        xmlns:p="http://primefaces.org/ui"
        xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
        xmlns:f="http://xmlns.jcp.org/jsf/core">

    <h:head>
        <title>Consulta do total de agendamentos por solicitante</title>
        <!-- Inclui o arquivo CSS específico para esta página -->
        <h:outputStylesheet library="css" name="consulta_agendamentos_por_solicitante.css"/>
    </h:head>

    <h:body id="body">

        <p:panel>
            <f:facet name="header">
                <div class="header-container">
                    <!-- Título da página -->
                    <h:outputText styleClass="header" value="Consulta de Agendamentos por Solicitante"/>
                    <!-- Botão de voltar para a página inicial -->
                    <p:commandButton value="Voltar" action="home" immediate="true" styleClass="back-button"/>
                </div>
            </f:facet>

            <h:form id="filterForm" class="form-container">
                <!-- Mensagens de validação e feedback -->
                <p:messages id="messages" autoUpdate="true" closable="true" showDetail="true"/>

                <div class="card">
                    <div class="ui-fluid formgrid grid">
                        <!-- Campo para data de início -->
                        <div class="field col-12 md:col-6">
                            <p:outputLabel for="dataInicio" value="Data Início:" />
                            <p:calendar id="dataInicio" value="#{agendamentoController.dataInicio}" pattern="dd/MM/yyyy"
                                        navigator="true" required="true" requiredMessage="Data de início é obrigatória" validatorMessage="Data inválida">
                                <f:validateRequired />
                            </p:calendar>
                            <p:message for="dataInicio" display="icon"/>
                        </div>
                        <!-- Campo para data de término -->
                        <div class="field col-12 md:col-6">
                            <p:outputLabel for="dataFim" value="Data Fim:" />
                            <p:calendar id="dataFim" value="#{agendamentoController.dataFim}" pattern="dd/MM/yyyy"
                                        navigator="true" required="true" requiredMessage="Data de fim é obrigatória" validatorMessage="Data inválida">
                                <f:validateRequired />
                            </p:calendar>
                            <p:message for="dataFim" display="icon"/>
                        </div>
                        <!-- Campo para selecionar solicitante -->
                        <div class="field col-12 md:col-6">
                            <p:outputLabel for="solicitante" value="Solicitante:" />
                            <p:selectOneMenu id="solicitante" value="#{agendamentoController.selectedSolicitanteId}"
                                             required="true" requiredMessage="Solicitante é obrigatório">
                                <f:selectItem itemLabel="Selecione" itemValue="#{null}" />
                                <f:selectItems value="#{agendamentoController.solicitantes}" var="solicitante"
                                               itemLabel="#{solicitante.nome}" itemValue="#{solicitante.id}"/>
                                <f:validateRequired />
                            </p:selectOneMenu>
                            <p:message for="solicitante" display="icon"/>
                        </div>
                        <!-- Botão para filtrar agendamentos por solicitante -->
                        <div class="field col-12 md:col-6 button-container">
                            <p:commandButton value="Filtrar" action="#{agendamentoController.filterAgendamentosPorSolicitante}" update=":resultForm, :filterForm:messages" ajax="true"/>
                        </div>
                    </div>
                </div>
            </h:form>
        </p:panel>

        <h:form id="resultForm" class="form-container">
            <!-- Tabela para exibir os resultados dos agendamentos filtrados -->
            <p:dataTable value="#{agendamentoController.agendamentosPorSolicitante}" var="agendamentoDTO" paginator="true" rows="10" rendered="#{not empty agendamentoController.agendamentosPorSolicitante}">
                <p:column headerText="Solicitante">
                    <h:outputText value="#{agendamentoDTO.solicitante}" />
                </p:column>
                <p:column headerText="Total de Agendamentos">
                    <h:outputText value="#{agendamentoDTO.totalAgendamentos}" />
                </p:column>
                <p:column headerText="Qtde Vagas">
                    <h:outputText value="#{agendamentoDTO.totalVagas}" />
                </p:column>
                <p:column headerText="Percentual">
                    <h:outputText value="#{agendamentoDTO.percentual}">
                        <f:convertNumber pattern="###.##" />
                    </h:outputText>
                    <h:outputText value=" %"/>
                </p:column>
            </p:dataTable>
        </h:form>

        <!-- Rodapé da página -->
        <div class="footer">
            <h:outputText value="Desenvolvido por: Fábio Santos Oliveira"/>
        </div>
    </h:body>
</ui:composition>
